<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cataloguer</title>
  <style>
    body {
      font-family: sans-serif;
      touch-action: manipulation;
    }
  </style>
</head>
<body onload="onBodyLoad()">
  <label for="fileInput">Load JSON file:</label>
  <input type="file" id="fileInput">
  <br><br>
  <button id="clearLocalStorageButton" onclick="clearLocalStorage()">Clear Local Storage</button>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
  <script>
    let alertLocalStorage = false;
    let images = []
    function onBodyLoad(){
      document.getElementById('fileInput').addEventListener('change', onFileInputChange)

      //First, check for json data in local storage.
      let jsonLocalStorage = localStorage.getItem("jsonData")
      if(jsonLocalStorage !== null){
        //If there is something in local storage, use it.
        if(alertLocalStorage)alert("Found local storage")
        jsonLocalStorage = JSON.parse(jsonLocalStorage)
        useJSONData(jsonLocalStorage)
      } else {
        //If nothing in local storage, load default JSON file with AJAX
        if(alertLocalStorage)alert("Did not find local storage")        
        $.ajax({
          url: "default.json",
          success: function(data) {
            //Data is a json object
            useJSONData(data)
          }
        })
      }
    }
    function onFileInputChange(event){
      const reader = new FileReader();
      reader.onload = onReaderLoad;
      reader.readAsText(event.target.files[0]);
    }
    function onReaderLoad(event){
      const obj = JSON.parse(event.target.result);
      //Do things with JSON
      useJSONData(obj)
    }
    function useJSONData(data){
      //Store data in local storage
      localStorage.setItem("jsonData", JSON.stringify(data))
      if(alertLocalStorage)alert("local storage has been updated")
      images = data.images;
      tags = data.tags;
    }
    
    function clearLocalStorage(){
      localStorage.removeItem("jsonData")
      if(alertLocalStorage)alert("Cleared local storage")
    }
  </script>
</body>
</html>